define("dnd", ["require", "exports", "module", "jquery", "base"], function (e, t, n) {
    function g(e) {
        switch (e.type) {
            case"mousedown":
                e.which === 1 && (y({target: e.target, pageX: e.pageX, pageY: e.pageY}), v === !0 && e.preventDefault());
                break;
            case"mousemove":
                v === !0 ? b() : m === !0 && (w({pageX: e.pageX, pageY: e.pageY}), E(), e.preventDefault());
                break;
            case"mouseup":
                v === !0 ? (l.remove(), l = null, a = null, v = !1) : m === !0 && (m = !1, l.css("cursor", "default"), l.focus(), S(), x())
        }
    }

    function y(e) {
        var t = i(e.target).parents().toArray();
        t.unshift(e.target), i.each(t, function (e, t) {
            if (i(t).data("dnd") !== undefined) {
                a = i(t).data("dnd");
                if (isNaN(parseInt(a, 10)) === !1)a = o[parseInt(a, 10)], f = i(t); else if (a === !0)a = new r(t, i(t).data("config")), f = i(t); else {
                    if (a !== !1)return!0;
                    a = null
                }
                return!1
            }
        });
        if (a === null || a.get("disabled") === !0)return;
        a.get("proxy") === null ? l = f.clone() : l = a.get("proxy"), l.css({position: "absolute", left: 0, top: 0, visibility: "hidden"}), l.appendTo(f.parent()), l.data("originx", l.offset().left), l.data("originy", l.offset().top), l.css({left: f.offset().left - l.data("originx"), top: f.offset().top - l.data("originy"), width: f.width(), height: f.height()}), h = e.pageX - f.offset().left, p = e.pageY - f.offset().top, v = !0
    }

    function b() {
        var e = a.get("visible"), t = a.get("dragCursor"), n = a.get("zIndex");
        e !== !0 && f.css("visibility", "hidden"), l.css({"z-index": n, visibility: "visible", cursor: t}), l.focus(), d = {}, v = !1, m = !0, a.trigger("dragstart", d, l)
    }

    function w(e) {
        var t = a.get("containment"), n = a.get("axis"), r = e.pageX - h, i = e.pageY - p, s = l.data("originx"), o = l.data("originy"), u = t.offset();
        u || (u = {left: 0, top: 0}), n !== "y" && (r >= u.left && r + l.outerWidth() <= u.left + t.outerWidth() ? l.css("left", r - s) : r <= u.left ? l.css("left", u.left - s) : l.css("left", u.left + t.outerWidth() - l.outerWidth() - s)), n !== "x" && (i >= u.top && i + l.outerHeight() <= u.top + t.outerHeight() ? l.css("top", i - o) : i <= u.top ? l.css("top", u.top - o) : l.css("top", u.top + t.outerHeight() - l.outerHeight() - o)), a.trigger("drag", l, c)
    }

    function E() {
        var e = a.get("drops"), t = a.get("dragCursor"), n = a.get("dropCursor"), r = l.offset().left + h, s = l.offset().top + p;
        if (e === null)return;
        c === null ? i.each(e, function (e, t) {
            if (T(t, r, s) === !0)return l.css("cursor", n), l.focus(), c = i(t), a.trigger("dragenter", l, c), !1
        }) : T(c, r, s) === !1 ? (l.css("cursor", t), l.focus(), a.trigger("dragleave", l, c), c = null) : a.trigger("dragover", l, c)
    }

    function S() {
        var e = a.get("revert"), t = l.data("originx"), n = l.data("originy");
        if (c === null)return;
        T(c, l) === !1 && e === !1 && (l.css("left", c.offset().left + (c.outerWidth() - l.outerWidth()) / 2 - t), l.css("top", c.offset().top + (c.outerHeight() - l.outerHeight()) / 2 - n)), a.trigger("drop", d, l, c)
    }

    function x() {
        var e = a.get("drops"), t = a.get("revert"), n = a.get("revertDuration"), r = a.get("visible"), i = a.get("zIndex"), s = l.offset().left - f.offset().left, o = l.offset().top - f.offset().top, u = l.data("originx"), h = l.data("originy");
        t === !0 || c === null && e !== null ? l.animate({left: f.offset().left - u, top: f.offset().top - h}, n, function () {
            f.css("visibility", ""), l.remove(), l = null, a.trigger("dragend", f, c), a = null, c = null
        }) : (f.css("position") === "relative" ? (s = (isNaN(parseInt(f.css("left"), 10)) ? 0 : parseInt(f.css("left"), 10)) + s, o = (isNaN(parseInt(f.css("top"), 10)) ? 0 : parseInt(f.css("top"), 10)) + o) : f.css("position") === "absolute" ? (s = l.offset().left, o = l.offset().top) : f.css("position", "relative"), r === !1 ? (f.css({left: s, top: o, visibility: "", "z-index": i}), l.remove(), l = null, a.trigger("dragend", f, c), a = null, c = null) : f.animate({left: s, top: o}, n, function () {
            l.remove(), l = null, a.trigger("dragend", f, c), a = null, c = null
        }))
    }

    function T(e, t, n) {
        var r = i(e).offset();
        r || (r = {left: 0, top: 0});
        if (arguments.length === 2)return r.left <= i(t).offset().left && r.left + i(e).outerWidth() >= i(t).offset().left + i(t).outerWidth() && r.top <= i(t).offset().top && r.top + i(e).outerHeight() >= i(t).offset().top + i(t).outerHeight();
        if (arguments.length === 3)return r.left <= t && r.left + i(e).outerWidth() >= t && r.top <= n && r.top + i(e).outerHeight() >= n
    }

    var r = null, i = e("jquery"), s = e("base"), o = [], u = 0, a = null, f = null, l = null, c = null, h = 0, p = 0, d = {}, v = !1, m = !1;
    r = s.extend({attrs: {elements: {value: null, readOnly: !0}, containment: {value: i(document), setter: function (e) {
        return i(e).eq(0)
    }}, proxy: {value: null, setter: function (e) {
        return i(e).eq(0)
    }}, drops: {value: null, setter: function (e) {
        return i(e)
    }}, disabled: !1, visible: !1, axis: !1, revert: !1, revertDuration: 500, dragCursor: "move", dropCursor: "copy", zIndex: 9999}, initialize: function (e, t) {
        elements = i(e), elements.length === 0 && i.error("element error!"), t = i.extend({elements: elements}, t), r.superclass.initialize.call(this, t), i(elements).data("dnd", u), o[u++] = this
    }}), r.open = function () {
        i(document).on("mousedown mousemove mouseup", g)
    }, r.close = function () {
        i(document).off("mousedown mousemove mouseup", g)
    }, r.open(), n.exports = r
});