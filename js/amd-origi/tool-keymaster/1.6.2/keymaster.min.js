//     keymaster.js
//     (c) 2011-2013 Thomas Fuchs
//     keymaster.js may be freely distributed under the MIT license.

define("keymaster",["require","exports","module"],function(e,t,n){(function(e){function l(e,t){var n=e.length;while(n--)if(e[n]===t)return n;return-1}function c(e,t){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function p(e){for(t in i)i[t]=e[h[t]]}function d(e){var t,n,s,u,a,c;t=e.keyCode,l(f,t)==-1&&f.push(t);if(t==93||t==224)t=91;if(t in i){i[t]=!0;for(s in o)o[s]==t&&(g[s]=!0);return}p(e);if(!g.filter.call(this,e))return;if(!(t in r))return;c=x();for(u=0;u<r[t].length;u++){n=r[t][u];if(n.scope==c||n.scope=="all"){a=n.mods.length>0;for(s in i)if(!i[s]&&l(n.mods,+s)>-1||i[s]&&l(n.mods,+s)==-1)a=!1;(n.mods.length==0&&!i[16]&&!i[18]&&!i[17]&&!i[91]||a)&&n.method(e,n)===!1&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0))}}}function v(e){var t=e.keyCode,n,r=l(f,t);r>=0&&f.splice(r,1);if(t==93||t==224)t=91;if(t in i){i[t]=!1;for(n in o)o[n]==t&&(g[n]=!1)}}function m(){for(t in i)i[t]=!1;for(t in o)g[t]=!1}function g(e,t,n){var i,s;i=N(e),n===undefined&&(n=t,t="all");for(var o=0;o<i.length;o++)s=[],e=i[o].split("+"),e.length>1&&(s=C(e),e=[e[e.length-1]]),e=e[0],e=a(e),e in r||(r[e]=[]),r[e].push({shortcut:i[o],scope:t,method:n,key:i[o],mods:s})}function y(e,t){var n,i,s=[],o,u,f;n=N(e);for(u=0;u<n.length;u++){i=n[u].split("+"),i.length>1&&(s=C(i),e=i[i.length-1]),e=a(e),t===undefined&&(t=x());if(!r[e])return;for(o=0;o<r[e].length;o++)f=r[e][o],f.scope===t&&c(f.mods,s)&&(r[e][o]={})}}function b(e){return typeof e=="string"&&(e=a(e)),l(f,e)!=-1}function w(){return f.slice(0)}function E(e){var t=(e.target||e.srcElement).tagName;return t!="INPUT"&&t!="SELECT"&&t!="TEXTAREA"}function S(e){s=e||"all"}function x(){return s||"all"}function T(e){var t,n,i;for(t in r){n=r[t];for(i=0;i<n.length;)n[i].scope===e?n.splice(i,1):i++}}function N(e){var t;return e=e.replace(/\s/g,""),t=e.split(","),t[t.length-1]==""&&(t[t.length-2]+=","),t}function C(e){var t=e.slice(0,e.length-1);for(var n=0;n<t.length;n++)t[n]=o[t[n]];return t}function k(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,function(){n(window.event)})}function A(){var t=e.key;return e.key=L,t}var t,r={},i={16:!1,18:!1,17:!1,91:!1},s="all",o={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},u={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},a=function(e){return u[e]||e.toUpperCase().charCodeAt(0)},f=[];for(t=1;t<20;t++)u["f"+t]=111+t;var h={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};for(t in o)g[t]=!1;k(document,"keydown",function(e){d(e)}),k(document,"keyup",v),k(window,"focus",m);var L=e.key;e.key=g,e.key.setScope=S,e.key.getScope=x,e.key.deleteScope=T,e.key.filter=E,e.key.isPressed=b,e.key.getPressedKeyCodes=w,e.key.noConflict=A,e.key.unbind=y,n.exports=e.key})(this)});